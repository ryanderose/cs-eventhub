{
  "$schema": "https://openapi.vercel.sh/vercel.json",
  "functions": {
    "api/v1/compose.ts": { "runtime": "edge", "maxDuration": 15 },
    "api/v1/fragment.ts": { "runtime": "edge" },
    "api/v1/plan/[id].ts": { "runtime": "nodejs20.x" },
    "api/v1/interpret.ts": { "runtime": "nodejs20.x" }
  },
  "rewrites": [
    { "source": "/v1/compose", "destination": "/api/v1/compose" },
    { "source": "/v1/interpret", "destination": "/api/v1/interpret" },
    { "source": "/v1/plan/(?<id>[^/]+)", "destination": "/api/v1/plan/$id" },
    { "source": "/v1/fragment", "destination": "/api/v1/fragment" },
    {
      "source": "/v1/fragment/(?<tenantId>[^/]+)",
      "destination": "/api/v1/fragment?tenantId=$tenantId"
    },
    {
      "source": "/config/tenants/(?<tenantId>[^/]+)\.json",
      "destination": "/api/config/tenants/$tenantId.json"
    },
    {
      "source": "/tenants/(?<tenantId>[^/]+)\.json",
      "has": [{ "type": "host", "value": "config.townthink.com" }],
      "destination": "/api/config/tenants/$tenantId.json"
    }
  ],
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        { "key": "X-Frame-Options", "value": "SAMEORIGIN" },
        { "key": "X-Content-Type-Options", "value": "nosniff" }
      ]
    },
    {
      "source": "/(.*)",
      "has": [{ "type": "host", "value": "preview-api.townthink.com" }],
      "headers": [{ "key": "x-environment", "value": "preview" }]
    },
    {
      "source": "/(.*)",
      "has": [{ "type": "host", "value": "beta-api.townthink.com" }],
      "headers": [{ "key": "x-environment", "value": "beta" }]
    },
    {
      "source": "/(.*)",
      "has": [{ "type": "host", "value": "api.townthink.com" }],
      "headers": [{ "key": "x-environment", "value": "production" }]
    }
  ]
}
